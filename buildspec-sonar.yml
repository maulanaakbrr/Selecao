version: 0.2

phases:
  install:
    commands:
      - echo "‚¨áÔ∏è Installing Sonar Scanner..."
      - curl -sSLo sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip
      - unzip -q sonar-scanner.zip -d /opt
      - export PATH=$PATH:/opt/sonar-scanner-5.0.1.3006-linux/bin

  build:
    commands:
      - echo "üîç Running SonarCloud analysis..."
      # # ‚úÖ fetch token from Secrets Manager
      # - export SONAR_TOKEN=$(aws secretsmanager get-secret-value \
      #     --secret-id SONAR_TOKEN \
      #     --query SecretString \
      #     --output text)

      # ‚úÖ run sonar scanner
      - sonar-scanner \
          -Dsonar.organization=maulanaakbrr \
          -Dsonar.projectKey=maulanaakbrr_Selecao \
          -Dsonar.sources=. \
          -Dsonar.host.url=https://sonarcloud.io \
          -Dsonar.token=$SONAR_TOKEN
